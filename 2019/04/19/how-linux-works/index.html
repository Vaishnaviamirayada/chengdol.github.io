<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=6.7.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.7.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.7.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.7.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="Great book for all Linux developers and administrators! Just note for future quick revisit! Chapter1. The Big pictureThe most effective way to understand how an operating system works is through abstr">
<meta name="keywords" content="linux">
<meta property="og:type" content="article">
<meta property="og:title" content="How Linux Works, 2nd Edition">
<meta property="og:url" content="http://yoursite.com/2019/04/19/how-linux-works/index.html">
<meta property="og:site_name" content="海胆阶段&#39;s Blog">
<meta property="og:description" content="Great book for all Linux developers and administrators! Just note for future quick revisit! Chapter1. The Big pictureThe most effective way to understand how an operating system works is through abstr">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://drive.google.com/uc?id=1e0ziORmoEx6zPk6J6qEid26aWl-zw21G">
<meta property="og:image" content="https://drive.google.com/uc?id=1Hy8vWUIBuo33oH976PNEkVzvAOzCuyKJ">
<meta property="og:updated_time" content="2019-05-01T20:33:01.822Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="How Linux Works, 2nd Edition">
<meta name="twitter:description" content="Great book for all Linux developers and administrators! Just note for future quick revisit! Chapter1. The Big pictureThe most effective way to understand how an operating system works is through abstr">
<meta name="twitter:image" content="https://drive.google.com/uc?id=1e0ziORmoEx6zPk6J6qEid26aWl-zw21G">






  <link rel="canonical" href="http://yoursite.com/2019/04/19/how-linux-works/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>How Linux Works, 2nd Edition | 海胆阶段's Blog</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">海胆阶段's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>About</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags<span class="badge">30</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories<span class="badge">10</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives<span class="badge">34</span></a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/19/how-linux-works/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="海胆阶段">
      <meta itemprop="description" content="骐骥一跃，不能十步；驽马十驾，功在不舍">
      <meta itemprop="image" content="/images/cuishao.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="海胆阶段's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">How Linux Works, 2nd Edition

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-04-19 09:52:29" itemprop="dateCreated datePublished" datetime="2019-04-19T09:52:29-07:00">2019-04-19</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-05-01 13:33:01" itemprop="dateModified" datetime="2019-05-01T13:33:01-07:00">2019-05-01</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>Great book for all Linux developers and administrators! Just note for future quick revisit!</p>
<h3 id="Chapter1-The-Big-picture"><a href="#Chapter1-The-Big-picture" class="headerlink" title="Chapter1. The Big picture"></a>Chapter1. The Big picture</h3><p>The most effective way to understand how an operating system works is through abstraction—a fancy way of saying that you can ignore most of the details.</p>
<p>The <code>kernel</code> is software residing in memory that tells the CPU what to do. The kernel manages the hardware and acts primarily as an interface between the hardware and any running program.</p>
<p>Processes—the running programs that the kernel manages—collectively make up the system’s upper level, called <code>user space</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">+-------------------------------------------------------------------------+</span><br><span class="line">|                                                                         |</span><br><span class="line">|  User process                                                           |</span><br><span class="line">|                                                                         |</span><br><span class="line">|   +-------------------+   +-----------------+    +---------------+      |</span><br><span class="line">|   |  GUI              |   |  Servers        |    |  Shell        |      |</span><br><span class="line">|   |                   |   |                 |    |               |      |</span><br><span class="line">|   +-------------------+   +-----------------+    +---------------+      |</span><br><span class="line">|                                                                         |</span><br><span class="line">+-------------------------------------------------------------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">+-------------------------------------------------------------------------+</span><br><span class="line">|                                                                         |</span><br><span class="line">|  Linux kernel                                                           |</span><br><span class="line">|  +--------------+     +--------------------------+                      |</span><br><span class="line">|  |  system calls|     |   process management     |                      |</span><br><span class="line">|  +--------------+     +--------------------------+                      |</span><br><span class="line">|                                                                         |</span><br><span class="line">|  +---------------------+        +-------------------------------+       |</span><br><span class="line">|  |  device driver      |        |   memory management           |       |</span><br><span class="line">|  +---------------------+        +-------------------------------+       |</span><br><span class="line">+-------------------------------------------------------------------------+</span><br><span class="line"></span><br><span class="line">+-------------------------------------------------------------------------+</span><br><span class="line">|                                                                         |</span><br><span class="line">|  Hardware                                                               |</span><br><span class="line">|                                                                         |</span><br><span class="line">|  +-------------------+   +-------------------+   +---------------+      |</span><br><span class="line">|  |   CPU             |   |    RAM            |   |  Disk         |      |</span><br><span class="line">|  +-------------------+   +-------------------+   +---------------+      |</span><br><span class="line">|  +---------------------+                                                |</span><br><span class="line">|  |   Network           |                                                |</span><br><span class="line">|  +---------------------+                                                |</span><br><span class="line">+-------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>
<p>There is a critical difference between the ways that the kernel and user processes run: The kernel runs in kernel mode, and the user processes run in user mode. Code running in kernel mode has unrestricted access to the processor and main memory. This is a powerful but dangerous privilege that allows a kernel process to easily crash the entire system. The area that only the kernel can access is called kernel space.</p>
<p>User mode, in comparison, restricts access to a (usually quite small) subset of memory and safe CPU operations. User space refers to the parts of main memory that the user processes can access. If a process makes a mistake and crashes, the consequences are limited and can be cleaned up by the kernel. This means that if your web browser crashes, it probably won’t take down the scientific computation that you’ve been running in the background for days.</p>
<h4 id="Hardware"><a href="#Hardware" class="headerlink" title="Hardware"></a>Hardware</h4><p>A CPU is just an operator on memory; it reads its instructions and data from the memory and writes data back out to the memory.</p>
<p>You’ll often hear the term <code>state</code> in reference to memory, processes, the kernel, and other parts of a computer system. Strictly speaking, a state is a particular arrangement of bits. For example, if you have four bits in your memory, 0110, 0001, and 1011 represent three different states.</p>
<p>The term <code>image</code> refers to a particular physical arrangement of bits.</p>
<h4 id="Kernel"><a href="#Kernel" class="headerlink" title="Kernel"></a>Kernel</h4><p>Nearly everything that the kernel does revolves around main memory. One of the kernel’s tasks is to split memory into many subdivisions, and it must maintain certain state information about those subdivisions at all times. Each process gets its own share of memory, and the kernel must ensure that each process keeps to its share.</p>
<p>The kernel is in charge of managing tasks in four general system areas:<br><strong>Processes</strong>. The kernel is responsible for determining which processes are allowed to use the CPU.</p>
<p><strong>Memory</strong>. The kernel needs to keep track of all memory—what is currently allocated to a particular process, what might be shared between processes, and what is free.</p>
<p><strong>Device drivers</strong>. The kernel acts as an interface between hardware (such as a disk) and processes. It’s usually the kernel’s job to operate the hardware.</p>
<p><strong>System calls and support</strong>. Processes normally use system calls to communicate with the kernel.</p>
<p>The act of one process giving up control of the CPU to another process is called a context switch.</p>
<p>The kernel is responsible for context switching. To understand how this works, let’s think about a situation in which a process is running in user mode but its time slice is up. Here’s what happens:</p>
<ol>
<li>The CPU (the actual hardware) interrupts the current process based on an internal timer, switches into kernel mode, and hands control back to the kernel.</li>
<li>The kernel records the current state of the CPU and memory, which will be essential to resuming the process that was just interrupted.</li>
<li>The kernel performs any tasks that might have come up during the preceding time slice (such as collecting data from input and output, or I/O, operations).</li>
<li>The kernel is now ready to let another process run. The kernel analyzes the list of processes that are ready to run and chooses one.</li>
<li>The kernel prepares the memory for this new process, and then prepares the CPU.</li>
<li>The kernel tells the CPU how long the time slice for the new process will last.</li>
<li>The kernel switches the CPU into user mode and hands control of the CPU to the process.</li>
</ol>
<p>The context switch answers the important question of <em>when</em> the kernel runs. The answer is that it runs <em>between</em> process time slices during a context switch.</p>
<p>Modern CPUs include a <code>memory management unit (MMU)</code> that enables a memory access scheme called <code>virtual memory</code>. When using virtual memory, a process does not directly access the memory by its physical location in the hardware. Instead, the kernel sets up each process to act as if it had an entire machine to itself. When the process accesses some of its memory, the MMU intercepts the access and uses a memory address map to translate the memory location from the process into an actual physical memory location on the machine. The kernel must still initialize and continuously maintain and alter this memory address map. For example, during a context switch, the kernel has to change the map from the outgoing process to the incoming process.</p>
<blockquote>
<p>The implementation of a memory address map is called a page table.</p>
</blockquote>
<p>The kernel’s role with devices is pretty simple. A device is typically accessible only in kernel mode because improper access (such as a user process asking to turn off the power) could crash the machine. Another problem is that different devices rarely have the same programming interface, even if the devices do the same thing, such as two different network cards. Therefore, device drivers have traditionally been part of the kernel.</p>
<p>There are several other kinds of kernel features available to user processes. For example, <code>system calls</code> (or syscalls) perform specific tasks that a user process alone cannot do well or at all. For example, the acts of opening, reading, and writing files all involve system calls.</p>
<p>Other than init, <em>all</em> user processes on a Linux system start as a result of <code>fork()</code>, and most of the time, you also run <code>exec()</code> to start a new program instead of running a copy of an existing process.</p>
<h4 id="User-Space"><a href="#User-Space" class="headerlink" title="User Space"></a>User Space</h4><p>As mentioned earlier, the main memory that the kernel allocates for user processes is called <code>user space</code>. Because a process is simply a state (or image) in memory, user space also refers to the memory for the entire collection of running processes. </p>
<h4 id="Users"><a href="#Users" class="headerlink" title="Users"></a>Users</h4><p>A <code>user</code> is an entity that can run processes and own files. A user is associated with a username. For example, a system could have a user named billyjoe. However, the kernel does not manage the usernames; instead, it identifies users by simple numeric identifiers called userids.</p>
<p>Users exist primarily to support permissions and boundaries.</p>
<p>In addition, as powerful as the root user is, it still runs in the operating system’s user mode, not kernel mode.</p>
<p><code>Groups</code> are sets of users. The primary purpose of groups is to allow a user to share file access to other users in a group.</p>
<h3 id="Chapter-2-Basic-Commands-and-Directory-Hierarchy"><a href="#Chapter-2-Basic-Commands-and-Directory-Hierarchy" class="headerlink" title="Chapter 2. Basic Commands and Directory Hierarchy"></a>Chapter 2. Basic Commands and Directory Hierarchy</h3><p>Some resources:<br><em>UNIX for the Impatient</em><br><em>Learning the UNIX Operating System</em></p>
<p>The <code>shell</code> is one of the most important parts of a Unix system. A shell is a program that runs commands. The shell also serves as a small programming environment.</p>
<p>Many important parts of the system are actually <code>shell scripts</code>—text files that contain a sequence of shell commands. </p>
<p>There are many different Unix shells, but all derive several of their features from the <code>Bourne shell</code> (/bin/sh), a standard shell developed at Bell Labs for early versions of Unix. Every Unix system needs the Bourne shell in order to function correctly, as you will see throughout this book.</p>
<p>Linux uses an enhanced version of the Bourne shell called <code>bash</code> or the “Bourne-again” shell. The bash shell is the default shell on most Linux distributions, and /bin/sh is normally a link to bash on a Linux system. </p>
<blockquote>
<p><code>cat</code> command: The command is called cat because it performs concatenation when it prints the contents of more than one file.</p>
</blockquote>
<p>Pressing <code>CTRL-D</code> on an empty line stops the current standard input entry from the terminal (and often terminates a program). Don’t confuse this with <code>CTRL-C</code>, which terminates a program regardless of its input or output.</p>
<blockquote>
<p>Unix filenames do not need extensions and often do not carry them.</p>
</blockquote>
<p><code>shell globs</code> don’t match dot files unless you explicitly use a pattern such as <code>.*</code>. This is why <code>rm -rf ./*</code> doesn’t remove hidden objects.</p>
<blockquote>
<p>You can run into problems with globs because <code>.*</code> matches <code>.</code> and <code>..</code> (the current and parent directories)</p>
</blockquote>
<p>The shell can store temporary variables, called <code>shell variables</code>, containing the values of text strings. Shell variables are very useful for keeping track of values in scripts, and some shell variables control the way the shell behaves.</p>
<p>An <code>environment variable</code> is like a shell variable, but it’s not specific to the shell. All processes on Unix systems have environment variable storage. The main difference between environment and shell variables is that the operating system passes all of your shell’s <code>environment variables</code> to programs that the shell runs (for example, the sub-script), whereas shell variables cannot be accessed in the commands that you run.</p>
<p>Assign an environment variable with the shell’s <code>export</code> command. For example, if you’d like to make the <code>$STUFF</code> shell variable into an environment variable, use the following:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">STUFF=123</span><br><span class="line">export STUFF</span><br></pre></td></tr></table></figure></p>
<p><code>PATH</code> is a special environment variable that contains the <code>command path</code> (or path for short). A command path is a list of system directories that the shell searches when trying to locate a command.</p>
<p>resource:<br><em>Learning the vi and Vim Editorstm</em></p>
<p>Some <code>kill process</code> ways.There are many types of signals. The default is <code>TERM</code>, or terminate.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kill -STOP pid</span><br><span class="line">kill -CONT pid</span><br><span class="line">kill -KILL pid  # the same as kill -9 pid</span><br></pre></td></tr></table></figure></p>
<p>To see if you’ve accidentally suspended any processes on your current terminal, run the <code>jobs</code> command.</p>
<p>You can detach a process from the shell and put it in the “background” with the ampersand <code>&amp;</code>. The best way to make sure that a background process doesn’t bother you is to redirect its output (and possibly input).</p>
<p>Some executable files have an <code>s</code> in the <code>owner permissions</code> listing instead of an x. This indicates that the executable is <code>setuid</code>, meaning that when you execute the program, it runs as though the file owner is the user instead of you. Many programs use this <code>setuid</code> bit to run as root in order to get the privileges they need to change system files. One example is the <code>passwd</code> program, which needs to change the <code>/etc/passwd</code> file.</p>
<p>Directories also have permissions. You can list the contents of a directory if it’s readable, but you can only access a file in a directory if the directory is <code>executable</code>. (One common mistake people make when setting the permissions of directories is to accidentally remove the execute permission when using absolute modes.)</p>
<p>You can specify a set of default permissions with the <code>umask (user file-creation mode mask)</code>shell command, which applies a predefined set of permissions to any new file you create. In general, use <code>umask 022</code> if you want everyone to be able to see all of the files and directories that you create, and use <code>umask 077</code> if you don’t. (You’ll need to put the umask command with the desired mode in one of your startup files to make your new default permissions apply to later sessions).</p>
<blockquote>
<p>How to calculate the <code>umask</code>?</p>
<p>For directories, the base permissions are (rwxrwxrwx) <code>0777</code> and for files they are <code>0666</code> (rw-rw-rw).</p>
<p>You can simply subtract the umask from the base permissions to determine the final permission for file as follows:<br>666 – 022 = 644<br>subtract to get permissions of new file (666-022) : 644 (rw-r–r–)</p>
<p>You can simply subtract the umask from the base permissions to determine the final permission for directory as follows:<br>777 – 022 = 755<br>Subtract to get permissions of new directory (777-022) : 755 (rwxr-xr-x)</p>
</blockquote>
<p>Another compression program in Unix is <code>bzip2</code>, whose compressed files end with <code>.bz2</code>. While marginally slower than gzip, bzip2 often compacts text files a little more, and it is therefore increasingly popular in the distribution of source code. </p>
<p>The <code>bzip2</code> compression/decompression option for tar is <code>j</code>:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar jcvf xx.bz2 file...</span><br><span class="line">tar jxvf xx.bz2</span><br></pre></td></tr></table></figure></p>
<h4 id="Linux-Directory-Hierarchy-Essentials"><a href="#Linux-Directory-Hierarchy-Essentials" class="headerlink" title="Linux Directory Hierarchy Essentials"></a>Linux Directory Hierarchy Essentials</h4><p>Simplified overview of the hierarchy<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">                                                  +---------+</span><br><span class="line">                                                  |   /     |</span><br><span class="line">                                                  +-----+---+</span><br><span class="line">                                                        |</span><br><span class="line">    +-------------+-------------+-----------+----------------------+-----------+-----------+----------+</span><br><span class="line">    |             |             |           |           |          |           |           |          |</span><br><span class="line">    |             |             |           |           |          |           |           |          |</span><br><span class="line">    |             |             |           |           |          |           |           |          |</span><br><span class="line">    v             v             v           v           v          v           v           v          v</span><br><span class="line">+---+----+    +---+----+   +----+---+  +----+---+  +----+---+  +---+---+  +----+---+  +----+----+ +---------+</span><br><span class="line">|  /bin  |    |  /dev  |   |  /etc  |  |   /usr |  | /home  |  | /lib  |  |  /sbin |  |   /tmp  | |  /var   |</span><br><span class="line">+--------+    +--------+   +--------+  +----+---+  +--------+  +-------+  +--------+  +---------+ +----+----+</span><br><span class="line">                                            |                                                          |</span><br><span class="line">                                            |                                                     +----+-----+</span><br><span class="line">                                            |                                                     |          |</span><br><span class="line">              +---------+----------+--------------------+----------+                              |          |</span><br><span class="line">              |         |          |        |           |          |                              |          |</span><br><span class="line">              v         v          v        v           v          v                              v          v</span><br><span class="line">         +----+--+  +---+--+  +----+---+  +-+----+  +---+---+  +---+---+                     +----+---+  +---+----+</span><br><span class="line">         | bin/  |  | man/ |  |  lib/  |  |local/|  | sbin/ |  | share/|                     | log/   |  |  /tmp  |</span><br><span class="line">         +-------+  +------+  +--------+  +------+  +-------+  +-------+                     +--------+  +--------+</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p><code>/bin</code> Contains ready-to-run programs (also known as an executables), including most of the basic Unix commands such as ls and cp. Most of the programs in /bin are in binary format, having been created by a C compiler, but some are shell scripts in modern systems.</p>
</li>
<li><p><code>/dev</code> Contains device files.</p>
</li>
<li><p><code>/etc</code> This core system configuration directory contains the user password, boot, device, networking, and other setup files. Many items in /etc are specific to the machine’s hardware. </p>
</li>
<li><p><code>/home</code> Holds personal directories for regular users. </p>
</li>
<li><p><code>/lib</code> An abbreviation for library, this directory holds library files containing code that executables can use.</p>
</li>
<li><p><code>/proc</code> Provides system statistics through a browsable directory-and-file interface. The <code>/proc</code> directory contains information about currently running processes as well as some kernel parameters.</p>
</li>
<li><p><code>/sys</code> This directory is similar to /proc in that it provides a device and system interface.</p>
</li>
<li><p><code>/sbin</code> The place for system executables. Programs in /sbin directories relate to system management.</p>
</li>
<li><p><code>/tmp</code> A storage area for smaller, temporary files that you don’t care much about. If something is extremely important, don’t put it in /tmp because most distributions clear /tmp when the machine boots and some even remove its old files periodically. Also, don’t let /tmp fill up with garbage because its space is usually shared with something critical  </p>
</li>
<li><p><code>/usr</code> Although pronounced “user,” this subdirectory has no user files. Instead, it contains a large directory hierarchy, including the bulk of the Linux system. Many of the directory names in /usr are the same as those in the root directory (like /usr/bin and /usr/lib), and they hold the same type of files. (The reason that the root directory does not contain the complete system is primarily historic—in the past, it was to keep space requirements low for the root.)</p>
</li>
<li><p><code>/var</code> The variable subdirectory, where programs record runtime information. System logging, user tracking, caches, and other files that system programs create and manage are here.</p>
</li>
<li><p><code>/boot</code> Contains kernel boot loader files. These files pertain only to the very first stage of the Linux startup procedure.</p>
</li>
<li><p><code>/media</code> A base attachment point for removable media such as flash drives that is found in many distributions.</p>
</li>
<li><p><code>/opt</code> This may contain additional third-party software. </p>
</li>
</ul>
<h4 id="Kernel-Location"><a href="#Kernel-Location" class="headerlink" title="Kernel Location"></a>Kernel Location</h4><p>On Linux systems, the kernel is normally in <code>/vmlinuz</code> or <code>/boot/vmlinuz</code>. A boot loader loads this file into memory and sets it in motion when the system boots.</p>
<p>Once the boot loader runs and sets the kernel in motion, the main kernel file is no longer used by the running system. However, you’ll find many modules that the kernel can load and unload on demand during the course of normal system operation. Called loadable kernel modules, they are located under <code>/lib/modules</code>.</p>
<h3 id="Chapter-3-Devices"><a href="#Chapter-3-Devices" class="headerlink" title="Chapter 3. Devices"></a>Chapter 3. Devices</h3><p>It’s important to understand how the kernel interacts with user space when presented with new devices. The <code>udev</code> system enables user-space programs to automatically configure and use new devices. </p>
<blockquote>
<p><code>udev</code> (userspace /dev) is a device manager for the Linux kernel. As the successor of devfsd and hotplug, udev primarily manages device nodes in the /dev directory.</p>
</blockquote>
<h4 id="Device-Files"><a href="#Device-Files" class="headerlink" title="Device Files"></a>Device Files</h4><p>It is easy to manipulate most devices on a Unix system because the kernel presents many of the device I/O interfaces to user processes as <strong>files</strong>. These device files are sometimes called <code>device nodes</code>. Not only can a programmer use regular file operations to work with a device, but some devices are also accessible to standard programs like <code>cat</code>. However, not all devices or device capabilities are accessible with standard file I/O.</p>
<p>Device files are in the <code>/dev</code> directory, and running <code>ls /dev</code> reveals more than a few files in <code>/dev</code>.</p>
<p>if run<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ls -l</span><br><span class="line">brw-rw----     1 root disk 8, 1 Sep  6 08:37 sda1</span><br><span class="line">crw-rw-rw-     1 root root 1, 3 Sep  6 08:37 null</span><br><span class="line">prw-r--r--     1 root root    0 Mar  3 19:17 fdata</span><br><span class="line">srw-rw-rw-     1 root root    0 Dec 18 07:43 log</span><br></pre></td></tr></table></figure></p>
<p>if the first char in file mode is <code>b</code>, <code>c</code>, <code>p</code>, or <code>s</code>, the file is a device. These letters stand for block, character, pipe, and socket, respectively.</p>
<p>The numbers before the dates in the first two lines are the <code>major</code> and <code>minor</code> device numbers that help the kernel identify the device. Similar devices usually have the same major number.</p>
<h5 id="Block-device"><a href="#Block-device" class="headerlink" title="Block device"></a>Block device</h5><p>Programs access data from a block device in fixed chunks. The sad1 in the preceding example is a disk device, a type of block device.</p>
<h5 id="Character-device"><a href="#Character-device" class="headerlink" title="Character device"></a>Character device</h5><p>Character devices work with data streams. Printers directly attached to your computer are represented by character devices. It’s important to note that during character device interaction, the kernel cannot back up and reexamine the data stream after it has passed data to a device or process.</p>
<h5 id="Pipe-device"><a href="#Pipe-device" class="headerlink" title="Pipe device"></a>Pipe device</h5><p>Named pipes are like character devices, with another process at the other end of the I/O stream instead of a kernel driver.</p>
<h4 id="Socket-device"><a href="#Socket-device" class="headerlink" title="Socket device"></a>Socket device</h4><p>Sockets are special-purpose interfaces that are frequently used for interprocess communication. </p>
<blockquote>
<p>Not all devices have device files because the block and character device I/O interfaces are not appropriate in all cases. For example, <code>network interfaces</code> don’t have device files. It is theoretically possible to interact with a network interface using a single character device, but because it would be exceptionally difficult, the kernel uses other I/O interfaces.</p>
</blockquote>
<h4 id="The-sysfs-Device-Path"><a href="#The-sysfs-Device-Path" class="headerlink" title="The sysfs Device Path"></a>The sysfs Device Path</h4><p>To provide a uniform view for attached devices based on their actual hardware attributes, the Linux kernel offers the <code>sysfs</code> interface through a system of files and directories. The base path for devices is <code>/sys/devices</code> (this is a real directory!).<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ls -ltr /sys/devices/</span><br><span class="line"></span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x 21 root root 0 Apr 25 23:18 virtual</span><br><span class="line">drwxr-xr-x  3 root root 0 Apr 25 23:18 tracepoint</span><br><span class="line">drwxr-xr-x 10 root root 0 Apr 25 23:18 system</span><br><span class="line">drwxr-xr-x  3 root root 0 Apr 25 23:18 software</span><br><span class="line">drwxr-xr-x  8 root root 0 Apr 25 23:18 pnp0</span><br><span class="line">drwxr-xr-x  9 root root 0 Apr 25 23:18 platform</span><br><span class="line">drwxr-xr-x 15 root root 0 Apr 25 23:18 pci0000:00</span><br><span class="line">drwxr-xr-x  5 root root 0 Apr 25 23:18 msr</span><br><span class="line">drwxr-xr-x  6 root root 0 Apr 25 23:18 LNXSYSTM:00</span><br><span class="line">drwxr-xr-x  3 root root 0 Apr 25 23:18 breakpoint</span><br></pre></td></tr></table></figure></p>
<p>The <code>/dev</code> file is there so that user processes can use the device, whereas the <code>/sys/devices</code> path is used to view information and manage the device. In <code>/dev</code> you can run:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">udevadm info --query=all --name=/dev/null</span><br><span class="line"></span><br><span class="line">P: /devices/virtual/mem/null</span><br><span class="line">N: null</span><br><span class="line">E: DEVMODE=0666</span><br><span class="line">E: DEVNAME=/dev/null</span><br><span class="line">E: DEVPATH=/devices/virtual/mem/null</span><br><span class="line">E: MAJOR=1</span><br><span class="line">E: MINOR=3</span><br><span class="line">E: SUBSYSTEM=mem</span><br></pre></td></tr></table></figure></p>
<p>this command will show the sysfs location <code>/devices/virtual/mem/null</code></p>
<h4 id="dd-and-Devices"><a href="#dd-and-Devices" class="headerlink" title="dd and Devices"></a>dd and Devices</h4><p>The program <code>dd</code> is extremely useful when working with block and character devices. This program’s sole function is to read from an input file or stream and write to an output file or stream, possibly doing some encoding conversion on the way.</p>
<p>I am not using it.</p>
<h4 id="Device-Name-Summary"><a href="#Device-Name-Summary" class="headerlink" title="Device Name Summary"></a>Device Name Summary</h4><p>Not necessarily as described below, may be some variations:</p>
<ul>
<li>Hard Disks: /dev/sd*</li>
</ul>
<p>Most hard disks attached to current Linux systems correspond to device names with an <code>sd</code> prefix, such as <code>/dev/sda</code>, <code>/dev/sdb</code>, and so on. These devices represent entire disks; the kernel makes separate device files, such as <code>/dev/sda1</code> and <code>/dev/sda2</code>, for the partitions on a disk.</p>
<blockquote>
<p>The <code>sd</code> portion of the name stands for SCSI disk.</p>
</blockquote>
<p>Linux assigns devices to device files in the <strong>order</strong> in which its drivers encounter devices. This may cause problem when you remove one disk and insert another, because the device name changed for old disk. Most modern Linux systems use the Universally Unique Identifier (<code>UUID</code>) for persistent disk device access.</p>
<ul>
<li>CD and DVD Drives: /dev/sr*</li>
</ul>
<p>Linux recognizes most optical storage drives as the SCSI devices /dev/sr0, /dev/sr1, and so on. </p>
<ul>
<li><p>PATA Hard Disks: /dev/hd*</p>
</li>
<li><p>Terminals: /dev/tty<em>, /dev/pts/</em>, and /dev/tty</p>
</li>
</ul>
<p>Terminals are devices for moving characters between a user process and an I/O device, usually for text output to a terminal screen. </p>
<p><code>Pseudoterminal</code> devices are emulated terminals that understand the I/O features of real terminals. </p>
<p>Two common terminal devices are <code>/dev/tty1</code> (the first virtual console) and <code>/dev/pts/0</code> (the first pseudoterminal device). The <code>/dev/tty</code> device is the controlling terminal of the current process.</p>
<blockquote>
<p>teletypewriter, <code>tty</code> in shorthand</p>
</blockquote>
<p>I am always confused, at least you need to know <strong>shell</strong> is the command line interpreter!<br><a href="https://askubuntu.com/questions/506510/what-is-the-difference-between-terminal-console-shell-and-command-line" target="_blank" rel="noopener">What is the difference between Terminal, Console, Shell, and Command Line?</a></p>
<p>Linux has two primary display modes: <code>text mode</code> and an <code>X Window System server</code> (graphics mode, usually via a display manager). Although Linux systems traditionally booted in text mode, most distributions now use kernel parameters and interim graphical display mechanisms to completely hide text mode as the system is booting. In such cases, the system switches over to full graphics mode near the end of the boot process.</p>
<p>OK, skip rest of the content in Chapter 3.</p>
<h3 id="Chapter-4-Disks-and-Filesystems"><a href="#Chapter-4-Disks-and-Filesystems" class="headerlink" title="Chapter 4. Disks and Filesystems"></a>Chapter 4. Disks and Filesystems</h3><p>Schematic of a typical Linux disk:</p>
<p><img src="https://drive.google.com/uc?id=1e0ziORmoEx6zPk6J6qEid26aWl-zw21G" alt=""></p>
<p><code>Partitions</code> are subdivisions of the whole disk. On Linux, they’re denoted with a number after the whole block device, and therefore have device names such as <code>/dev/sda1</code> and <code>/dev/sdb3</code>.</p>
<p>Partitions are defined on a small area of the disk called a <code>partition table</code>.</p>
<p>The next layer after the partition is the <code>filesystem</code>, the database of files and directories that you’re accustomed to interacting with in user space.</p>
<p>To access data on a disk, the Linux kernel uses the system of layers like this:</p>
<p><img src="https://drive.google.com/uc?id=1Hy8vWUIBuo33oH976PNEkVzvAOzCuyKJ" alt=""></p>
<blockquote>
<p>Notice that you can work with the disk through the filesystem as well as directly through the disk devices.</p>
</blockquote>
<h4 id="Partitioning-Disk-Devices"><a href="#Partitioning-Disk-Devices" class="headerlink" title="Partitioning Disk Devices"></a>Partitioning Disk Devices</h4><blockquote>
<p>You can view RedHat <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/storage_administration_guide/ch-partitions" target="_blank" rel="noopener">Doc</a> for more information about partition</p>
</blockquote>
<p>Let’s view the partition table:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">parted -l</span><br><span class="line"></span><br><span class="line">Model: ATA WDC WD3200AAJS-2 (scsi)</span><br><span class="line">Disk /dev/sda: 320GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: msdos</span><br><span class="line"></span><br><span class="line">Number   Start   End    Size   Type      File system    Flags</span><br><span class="line"> 1       1049kB  316GB  316GB  primary   ext4           boot</span><br><span class="line"> 2       316GB   320GB  4235MB extended</span><br><span class="line"> 5       316GB   320GB  4235MB logical   linux-swap(v1)</span><br><span class="line"></span><br><span class="line">Model: FLASH Drive UT_USB20 (scsi)</span><br><span class="line">Disk /dev/sdf: 4041MB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: gpt</span><br><span class="line"></span><br><span class="line">Number  Start   End     Size     File system  Name        Flags</span><br><span class="line"> 1      17.4kB  1000MB  1000MB                myfirst</span><br><span class="line"> 2      1000MB  4040MB  3040MB                mysecond</span><br></pre></td></tr></table></figure></p>
<p>There are 2 different partition tables: MBR (msdos) and GPT (gpt). The MBR table in this example contains primary, extended, and logical partitions. </p>
<h4 id="Changing-Partition-Tables"><a href="#Changing-Partition-Tables" class="headerlink" title="Changing Partition Tables"></a>Changing Partition Tables</h4><p>You can use <code>parted</code> command to change partition. Check <code>/proc/partitions</code> can get full partition information.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/partitions</span><br><span class="line"></span><br><span class="line">major minor  #blocks  name</span><br><span class="line"> 252        0  262144000 vda</span><br><span class="line"> 252        1    1048576 vda1</span><br><span class="line"> 252        2  260976640 vda2</span><br><span class="line"> 253        0  252706816 dm-0</span><br><span class="line"> 253        1    8257536 dm-1</span><br></pre></td></tr></table></figure></p>
<h4 id="Filesystems"><a href="#Filesystems" class="headerlink" title="Filesystems"></a>Filesystems</h4><p>The last link between the kernel and user space for disks is typically the file-system; this is what you’re accustomed to interacting with when you run commands such as <code>ls</code> and <code>cd</code>. As previously mentioned, the <strong>filesystem is a form of database</strong>; it supplies the structure to transform a simple block device into the sophisticated hierarchy of files and subdirectories that users can understand.</p>
<h5 id="Filesystem-Types"><a href="#Filesystem-Types" class="headerlink" title="Filesystem Types"></a>Filesystem Types</h5><ul>
<li>The <code>Fourth Extended filesystem (ext4)</code> is the current iteration of a line of filesystems native to Linux. The <code>Second Extended filesystem (ext2)</code> was a longtime default for Linux systems inspired by traditional Unix filesystems such as the Unix File System (UFS) and the Fast File System (FFS). The <code>Third Extended filesystem (ext3)</code> added a journal feature (a small cache outside the normal filesystem data structure) to enhance data integrity and hasten booting. The ext4 filesystem is an incremental improvement with support for larger files than ext2 or ext3 support and a greater number of subdirectories.</li>
</ul>
<h5 id="Create-a-Filesystems"><a href="#Create-a-Filesystems" class="headerlink" title="Create a Filesystems"></a>Create a Filesystems</h5><p>Once you’re done with the partitioning process, you’re ready to create filesystems. As with partitioning, you’ll do this in user space because a user-space process can directly access and manipulate a block device. </p>
<p>For example, you can create an ext4 partition on /dev/sdf2<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkfs -t ext4 /dev/sdf2</span><br></pre></td></tr></table></figure></p>
<p>Filesystem creation is a task that you should only need to perform after adding a new disk or repartitioning an old one. You should create a filesystem just once for each new partition that has no preexisting data (or that has data that you want to remove). Creating a new filesystem on top of an existing filesystem will effectively destroy the old data.</p>
<p>It turns out that mkfs is only a frontend for a series of filesystem creation programs:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ls -l /sbin/mkfs.*</span><br><span class="line"></span><br><span class="line">-rwxr-xr-x. 1 root root 375240 Mar  7  2017 /sbin/mkfs.btrfs</span><br><span class="line">-rwxr-xr-x  1 root root  37080 Jul 12  2018 /sbin/mkfs.cramfs</span><br><span class="line">-rwxr-xr-x  4 root root  96384 Apr 10  2018 /sbin/mkfs.ext2</span><br><span class="line">-rwxr-xr-x  4 root root  96384 Apr 10  2018 /sbin/mkfs.ext3</span><br><span class="line">-rwxr-xr-x  4 root root  96384 Apr 10  2018 /sbin/mkfs.ext4</span><br><span class="line">-rwxr-xr-x  1 root root  37184 Jul 12  2018 /sbin/mkfs.minix</span><br><span class="line">-rwxr-xr-x. 1 root root 368504 Feb 27  2018 /sbin/mkfs.xfs</span><br></pre></td></tr></table></figure></p>
<h5 id="Mounting-a-Filesystem"><a href="#Mounting-a-Filesystem" class="headerlink" title="Mounting a Filesystem"></a>Mounting a Filesystem</h5><p>On Unix, the process of attaching a filesystem is called <code>mounting</code>. When the system boots, the kernel reads some configuration data and mounts root (/) based on the configuration data.</p>
<p>When mounting a filesystem, the common terminology is <em>mount a device on a mount point.</em></p>
<p>To see current system mount status:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mount </span><br><span class="line">...</span><br><span class="line">cgroup on /sys/fs/cgroup/devices type cgroup (rw,nosuid,nodev,noexec,relatime,devices)</span><br><span class="line">/dev/mapper/rhel-root on / type xfs (rw,relatime,attr2,inode64,noquota)</span><br><span class="line">mqueue on /dev/mqueue type mqueue (rw,relatime)</span><br><span class="line">hugetlbfs on /dev/hugepages type hugetlbfs (rw,relatime)</span><br><span class="line">/dev/vda1 on /boot type xfs (rw,relatime,attr2,inode64,noquota)</span><br><span class="line">tmpfs on /run/user/0 type tmpfs (rw,nosuid,nodev,relatime,size=800956k,mode=700)</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>There are 3 key fields:</p>
<ul>
<li>The filesystem’s device, such as a disk partition; where the actual file-system data resides</li>
<li>The filesystem type</li>
<li>The mount point—that is, the place in the current system’s directory hierarchy where the filesystem will be attached. </li>
</ul>
<p>For example, to mount the Fourth Extended filesystem /dev/sdf2 on /home/extra, use this command:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -t ext4 /dev/sdf2 /home/extra</span><br></pre></td></tr></table></figure></p>
<p>To unmount (detach) a filesystem, use the umount command:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umount mountpoint</span><br></pre></td></tr></table></figure></p>
<h5 id="Filesystem-UUID"><a href="#Filesystem-UUID" class="headerlink" title="Filesystem UUID"></a>Filesystem UUID</h5><p>You can identify and mount filesystems by their <code>Universally Unique Identifier (UUID)</code>, a software standard. The UUID is a type of serial number, and each one should be different.</p>
<p>For example, if you know the UUID of /dev/sdf2 is a9011c2b-1c03-4288-b3fe-8ba961ab0898, so you can mount it as:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount UUID=a9011c2b-1c03-4288-b3fe-8ba961ab0898 /home/extra</span><br></pre></td></tr></table></figure></p>
<p>Here no <code>-t  ext4</code> option, because mount know that.</p>
<p>To view a list of devices and the corresponding filesystems and UUIDs on your system, use the blkid (block ID) program:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">blkid</span><br><span class="line"></span><br><span class="line">/dev/sdf2: UUID=&quot;a9011c2b-1c03-4288-b3fe-8ba961ab0898&quot; TYPE=&quot;ext4&quot;</span><br><span class="line">/dev/sda1: UUID=&quot;70ccd6e7-6ae6-44f6-812c-51aab8036d29&quot; TYPE=&quot;ext4&quot;</span><br><span class="line">/dev/sda5: UUID=&quot;592dcfd1-58da-4769-9ea8-5f412a896980&quot; TYPE=&quot;swap&quot;</span><br><span class="line">/dev/sde1: SEC_TYPE=&quot;msdos&quot; UUID=&quot;3762-6138&quot; TYPE=&quot;vfat&quot;</span><br></pre></td></tr></table></figure></p>
<p>For one thing, they’re the preferred way to automatically mount filesystems in <code>/etc/fstab</code> at boot time.</p>
<h5 id="Disk-Buffering-Caching-and-Filesystems"><a href="#Disk-Buffering-Caching-and-Filesystems" class="headerlink" title="Disk Buffering, Caching, and Filesystems"></a>Disk Buffering, Caching, and Filesystems</h5><p>Linux, like other versions of Unix, buffers writes to the disk. This means that the kernel usually doesn’t immediately write changes to filesystems when processes request changes. <strong>Instead it stores the changes in RAM until the kernel can conveniently make the actual change to the disk</strong>. This buffering system is transparent to the user and improves performance.</p>
<blockquote>
<p>This is the reason why before we remove the USB, we need to unmount it in case of data lose.</p>
</blockquote>
<p>When you unmount a filesystem with umount, the kernel automatically synchronizes with the disk. At any other time, you can force the kernel to write the changes in its buffer to the disk by running the <code>sync</code> command.</p>
<h5 id="The-etc-fstab-Filesystem-Table"><a href="#The-etc-fstab-Filesystem-Table" class="headerlink" title="The /etc/fstab Filesystem Table"></a>The /etc/fstab Filesystem Table</h5><p>I encounter this when write <code>/etc/fstab</code> file with NFS when developing k8s.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/dev/mapper/rhel-root   /                       xfs     defaults        0 0</span><br><span class="line">UUID=a44461e9-e1d7-45fd-a387-255fafd14746 /boot                   xfs     defaults        0 0</span><br><span class="line">/dev/mapper/rhel-swap   swap                    swap    defaults        0 0</span><br><span class="line">halos1.fyre.ibm.com:/data /mnt nfs defaults,timeo=10,retrans=3,rsize=1048576,wsize=1048576 0 0</span><br></pre></td></tr></table></figure></p>
<p>To mount filesystems at boot time and take the drudgery out of the mount command, Linux systems keep a permanent list of filesystems and options in <code>/etc/fstab</code>.</p>
<ul>
<li><p><code>The device or UUID</code>. Most current Linux systems no longer use the device in /etc/fstab, preferring the UUID. </p>
</li>
<li><p><code>The mount point</code>. Indicates where to attach the filesystem.</p>
</li>
<li><p><code>The filesystem type</code>.</p>
</li>
<li><p><code>Options</code>. Use long mount options separated by commas.</p>
</li>
<li><p><code>Backup information for use by the dump command</code>. You should always use a 0 in this field.</p>
</li>
<li><p><code>The filesystem integrity test order.</code> To ensure that fsck always runs on the root first, always set this to 1 for the root filesystem and 2 for any other filesystems on a hard disk. Use <code>0</code> to disable the bootup check for everything else, including CD-ROM drives, swap, and the /proc file-system</p>
</li>
</ul>
<p>You can also try to mount all entries at once in /etc/fstab that do not contain the noauto option with this command:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -a</span><br></pre></td></tr></table></figure></p>
<p>Let’s see some commonly use options:</p>
<ul>
<li><p><code>defaults</code>. This uses the mount defaults: read-write mode, enable device files, executables, the setuid bit, and so on. Use this when you don’t want to give the filesystem any special options but you do want to fill all fields in /etc/fstab.</p>
</li>
<li><p><code>noauto</code>. This option tells a mount -a command to ignore the entry. </p>
</li>
</ul>
<h5 id="Filesystem-Capacity"><a href="#Filesystem-Capacity" class="headerlink" title="Filesystem Capacity"></a>Filesystem Capacity</h5><p>To view the size and utilization of your currently mounted filesystems, use the <code>df</code> command.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">df -BM</span><br><span class="line"></span><br><span class="line">Filesystem                1M-blocks   Used Available Use% Mounted on</span><br><span class="line">/dev/mapper/rhel-root       245640M 75636M   170005M  31% /</span><br><span class="line">devtmpfs                      7931M     0M     7931M   0% /dev</span><br><span class="line">tmpfs                         7943M     0M     7943M   0% /dev/shm</span><br><span class="line">tmpfs                         7943M   835M     7109M  11% /run</span><br><span class="line">tmpfs                         7943M     0M     7943M   0% /sys/fs/cgroup</span><br><span class="line">/dev/vda1                     1014M   183M      832M  19% /boot</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/linux/" rel="tag"># linux</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/04/13/linux-soft-link/" rel="next" title="Symbolic Link Operations">
                <i class="fa fa-chevron-left"></i> Symbolic Link Operations
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/04/27/music-渴望光荣/" rel="prev" title="渴望光荣">
                渴望光荣 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/cuishao.png" alt="海胆阶段">
            
              <p class="site-author-name" itemprop="name">海胆阶段</p>
              <p class="site-description motion-element" itemprop="description">骐骥一跃，不能十步；驽马十驾，功在不舍</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">34</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">10</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">30</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Chapter1-The-Big-picture"><span class="nav-number">1.</span> <span class="nav-text">Chapter1. The Big picture</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Hardware"><span class="nav-number">1.1.</span> <span class="nav-text">Hardware</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Kernel"><span class="nav-number">1.2.</span> <span class="nav-text">Kernel</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#User-Space"><span class="nav-number">1.3.</span> <span class="nav-text">User Space</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Users"><span class="nav-number">1.4.</span> <span class="nav-text">Users</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Chapter-2-Basic-Commands-and-Directory-Hierarchy"><span class="nav-number">2.</span> <span class="nav-text">Chapter 2. Basic Commands and Directory Hierarchy</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Linux-Directory-Hierarchy-Essentials"><span class="nav-number">2.1.</span> <span class="nav-text">Linux Directory Hierarchy Essentials</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Kernel-Location"><span class="nav-number">2.2.</span> <span class="nav-text">Kernel Location</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Chapter-3-Devices"><span class="nav-number">3.</span> <span class="nav-text">Chapter 3. Devices</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Device-Files"><span class="nav-number">3.1.</span> <span class="nav-text">Device Files</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Block-device"><span class="nav-number">3.1.1.</span> <span class="nav-text">Block device</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Character-device"><span class="nav-number">3.1.2.</span> <span class="nav-text">Character device</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Pipe-device"><span class="nav-number">3.1.3.</span> <span class="nav-text">Pipe device</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Socket-device"><span class="nav-number">3.2.</span> <span class="nav-text">Socket device</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#The-sysfs-Device-Path"><span class="nav-number">3.3.</span> <span class="nav-text">The sysfs Device Path</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#dd-and-Devices"><span class="nav-number">3.4.</span> <span class="nav-text">dd and Devices</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Device-Name-Summary"><span class="nav-number">3.5.</span> <span class="nav-text">Device Name Summary</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Chapter-4-Disks-and-Filesystems"><span class="nav-number">4.</span> <span class="nav-text">Chapter 4. Disks and Filesystems</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Partitioning-Disk-Devices"><span class="nav-number">4.1.</span> <span class="nav-text">Partitioning Disk Devices</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Changing-Partition-Tables"><span class="nav-number">4.2.</span> <span class="nav-text">Changing Partition Tables</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Filesystems"><span class="nav-number">4.3.</span> <span class="nav-text">Filesystems</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Filesystem-Types"><span class="nav-number">4.3.1.</span> <span class="nav-text">Filesystem Types</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Create-a-Filesystems"><span class="nav-number">4.3.2.</span> <span class="nav-text">Create a Filesystems</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Mounting-a-Filesystem"><span class="nav-number">4.3.3.</span> <span class="nav-text">Mounting a Filesystem</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Filesystem-UUID"><span class="nav-number">4.3.4.</span> <span class="nav-text">Filesystem UUID</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Disk-Buffering-Caching-and-Filesystems"><span class="nav-number">4.3.5.</span> <span class="nav-text">Disk Buffering, Caching, and Filesystems</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#The-etc-fstab-Filesystem-Table"><span class="nav-number">4.3.6.</span> <span class="nav-text">The /etc/fstab Filesystem Table</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Filesystem-Capacity"><span class="nav-number">4.3.7.</span> <span class="nav-text">Filesystem Capacity</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Chengdong Liao</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v6.7.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=6.7.0"></script>

  <script src="/js/src/motion.js?v=6.7.0"></script>



  
  

  
  <script src="/js/src/scrollspy.js?v=6.7.0"></script>
<script src="/js/src/post-details.js?v=6.7.0"></script>



  


  <script src="/js/src/bootstrap.js?v=6.7.0"></script>



  



  











  





  

  

  

  

  

  

  

  

  

  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  <script>
    $('.highlight').each(function (i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap');
      $(e).after($wrap);
      $wrap.append($('<button>').addClass('copy-btn').append('Copy').on('click', function (e) {
        var code = $(this).parent().find('.code').find('.line').map(function (i, e) {
          return $(e).text();
        }).toArray().join('\n');
        var ta = document.createElement('textarea');
        var range = document.createRange(); //For Chrome
        var sel = window.getSelection(); //For Chrome
        var yPosition = window.pageYOffset || document.documentElement.scrollTop;
        ta.style.top = yPosition + 'px'; //Prevent page scroll
        ta.style.position = 'absolute';
        ta.style.opacity = '0';
        ta.value = code;
        ta.textContent = code; //For FireFox
        ta.contentEditable = true;
        ta.readOnly = false;
        document.body.appendChild(ta);
        range.selectNode(ta);
        sel.removeAllRanges();
        sel.addRange(range);
        ta.setSelectionRange(0, code.length);
        var result = document.execCommand('copy');
        
          if (result) $(this).text('Copied');
          else $(this).text('Copy failed');
        
        ta.blur(); //For iOS
        $(this).blur();
      })).on('mouseleave', function (e) {
        var $b = $(this).find('.copy-btn');
        setTimeout(function () {
          $b.text('Copy');
        }, 300);
      }).append(e);
    })
  </script>


  

</body>
</html>
